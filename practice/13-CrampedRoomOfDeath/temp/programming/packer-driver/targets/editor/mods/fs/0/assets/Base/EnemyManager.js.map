{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Base/EnemyManager.ts"],"names":["_decorator","DIRECTION_ENUM","ENTITY_STATE_ENUM","EVENT_ENUM","EventManager","EntityManager","DataManager","ccclass","property","EnemyManager","init","params","Instance","on","PLAYER_BORN","onChangeDirection","PLAYER_MOVE_END","ATTACK_ENEMY","onDeath","onDestroy","off","isInit","state","DEATH","player","x","playerX","y","playerY","disX","Math","abs","disY","direction","TOP","RIGHT","LEFT","BOTTOM","id"],"mappings":"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","sourcesContent":["import {_decorator} from 'cc';\nimport {DIRECTION_ENUM, ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM, EVENT_ENUM} from \"db://assets/Enums\";\nimport EventManager from \"db://assets/Runtime/EventManager\";\nimport {EntityManager} from \"db://assets/Base/EntityManager\";\nimport DataManager from \"db://assets/Runtime/DataManager\";\nimport {WoodenSkeletonStateMachine} from \"db://assets/Scripts/WoodenSkeleton/WoodenSkeletonStateMachine\";\nimport {IEntity} from \"db://assets/Levels\";\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('EnemyManager')\nexport class EnemyManager extends EntityManager {\n\n    async init(params: IEntity){\n        super.init(params);\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_BORN, this.onChangeDirection, this);\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_MOVE_END, this.onChangeDirection, this);\n        EventManager.Instance.on(EVENT_ENUM.ATTACK_ENEMY, this.onDeath, this);\n        this.onChangeDirection(true);\n    }\n\n    onDestroy(){\n        super.onDestroy();\n        EventManager.Instance.off(EVENT_ENUM.PLAYER_BORN, this.onChangeDirection);\n        EventManager.Instance.off(EVENT_ENUM.PLAYER_MOVE_END, this.onChangeDirection);\n        EventManager.Instance.off(EVENT_ENUM.ATTACK_ENEMY, this.onDeath);\n    }\n\n    onChangeDirection(isInit: boolean = false){\n        if(this.state === ENTITY_STATE_ENUM.DEATH || !DataManager.Instance.player){\n            return;\n        }\n        const { x: playerX, y: playerY } = DataManager.Instance.player;\n        const disX = Math.abs(this.x - playerX);\n        const disY = Math.abs(this.y - playerY);\n        if(disX === disY && !isInit){\n            return\n        }\n        //第一象限\n        if (playerX >= this.x && playerY <= this.y){\n            this.direction = disY > disX ? DIRECTION_ENUM.TOP : DIRECTION_ENUM.RIGHT;\n        }else if (playerX <= this.x && playerY <= this.y){\n            this.direction = disY > disX ? DIRECTION_ENUM.TOP : DIRECTION_ENUM.LEFT;\n        }else if (playerX <= this.x && playerY >= this.y){\n            this.direction = disY > disX ? DIRECTION_ENUM.BOTTOM : DIRECTION_ENUM.LEFT;\n        }else if (playerX >= this.x && playerY >= this.y){\n            this.direction = disY > disX ? DIRECTION_ENUM.BOTTOM : DIRECTION_ENUM.RIGHT;\n        }\n    }\n\n    onDeath(id: string){\n        if(this.state === ENTITY_STATE_ENUM.DEATH){\n            return;\n        }\n        if(this.id === id){\n            this.state = ENTITY_STATE_ENUM.DEATH;\n        }\n    }\n}\n\n"]}