{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/WoodenSkeleton/WoodenSkeletonManager.ts"],"names":["_decorator","DIRECTION_ENUM","ENTITY_STATE_ENUM","ENTITY_TYPE_ENUM","EVENT_ENUM","EventManager","EntityManager","DataManager","WoodenSkeletonStateMachine","ccclass","property","ANIMATION_SPEED","WoodenSkeletonManager","init","fsm","node","addComponent","x","y","type","PLAYER","direction","TOP","state","IDLE","Instance","on","PLAYER_BORN","onChangeDirection","PLAYER_MOVE_END","onAttack","isInit","player","playerX","playerY","disX","Math","abs","disY","RIGHT","LEFT","BOTTOM","playerState","DEATH","ATTACK","emit","ATTACK_PLAYER"],"mappings":"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","sourcesContent":["import {_decorator} from 'cc';\nimport {DIRECTION_ENUM, ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM, EVENT_ENUM} from \"db://assets/Enums\";\nimport EventManager from \"db://assets/Runtime/EventManager\";\nimport {EntityManager} from \"db://assets/Base/EntityManager\";\nimport DataManager from \"db://assets/Runtime/DataManager\";\nimport {WoodenSkeletonStateMachine} from \"db://assets/Scripts/WoodenSkeleton/WoodenSkeletonStateMachine\";\n\nconst { ccclass, property } = _decorator;\n\nconst ANIMATION_SPEED = 1/8;\n\n@ccclass('WoodenSkeletonManager')\nexport class WoodenSkeletonManager extends EntityManager {\n\n    async init(){\n        this.fsm = this.node.addComponent(WoodenSkeletonStateMachine);\n        await this.fsm.init();\n        super.init({\n            x: 7,\n            y: 7,\n            type: ENTITY_TYPE_ENUM.PLAYER,\n            direction: DIRECTION_ENUM.TOP,\n            state: ENTITY_STATE_ENUM.IDLE\n        });\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_BORN, this.onChangeDirection, this);\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_MOVE_END, this.onChangeDirection, this);\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_MOVE_END, this.onAttack, this);\n        this.onChangeDirection(true);\n    }\n\n    onChangeDirection(isInit: boolean = false){\n        if(!DataManager.Instance.player){\n            return;\n        }\n        const { x: playerX, y: playerY } = DataManager.Instance.player;\n        const disX = Math.abs(this.x - playerX);\n        const disY = Math.abs(this.y - playerY);\n        if(disX === disY && !isInit){\n            return\n        }\n        //第一象限\n        if (playerX >= this.x && playerY <= this.y){\n            this.direction = disY > disX ? DIRECTION_ENUM.TOP : DIRECTION_ENUM.RIGHT;\n        }else if (playerX <= this.x && playerY <= this.y){\n            this.direction = disY > disX ? DIRECTION_ENUM.TOP : DIRECTION_ENUM.LEFT;\n        }else if (playerX <= this.x && playerY >= this.y){\n            this.direction = disY > disX ? DIRECTION_ENUM.BOTTOM : DIRECTION_ENUM.LEFT;\n        }else if (playerX >= this.x && playerY >= this.y){\n            this.direction = disY > disX ? DIRECTION_ENUM.BOTTOM : DIRECTION_ENUM.RIGHT;\n        }\n    }\n\n    onAttack(){\n        const { x: playerX, y: playerY, state: playerState } = DataManager.Instance.player;\n        if(playerState === ENTITY_STATE_ENUM.DEATH){\n            return \n        }\n        if(\n            (this.x === playerX && Math.abs(this.y - playerY) <= 1) ||\n            (this.y === playerY && Math.abs(this.x - playerX) <= 1)\n        ){\n            this.state = ENTITY_STATE_ENUM.ATTACK;\n            //玩家切换die状态\n            EventManager.Instance.emit(EVENT_ENUM.ATTACK_PLAYER, ENTITY_STATE_ENUM.DEATH);\n        }else {\n            this.state = ENTITY_STATE_ENUM.IDLE;\n        }\n    }\n}\n\n"]}