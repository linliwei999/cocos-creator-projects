{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/WoodenSkeleton/WoodenSkeletonManager.ts"],"names":["_decorator","ENTITY_STATE_ENUM","EVENT_ENUM","EventManager","DataManager","WoodenSkeletonStateMachine","EnemyManager","ccclass","property","ANIMATION_SPEED","WoodenSkeletonManager","init","params","fsm","node","addComponent","Instance","on","PLAYER_MOVE_END","onAttack","onDestroy","off","state","DEATH","player","x","playerX","y","playerY","playerState","Math","abs","ATTACK","emit","ATTACK_PLAYER","IDLE"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,MAAAA,U,OAAAA,U;;AACgBC,MAAAA,iB,iBAAAA,iB;AAAqCC,MAAAA,U,iBAAAA,U;;AACtDC,MAAAA,Y;;AAEAC,MAAAA,W;;AACCC,MAAAA,0B,iBAAAA,0B;;AACAC,MAAAA,Y,iBAAAA,Y;;;;;;;OAGF;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;AAExBS,MAAAA,e,GAAkB,IAAE,C;;uCAGbC,qB,WADZH,OAAO,CAAC,uBAAD,C,gBAAR,MACaG,qBADb;AAAA;AAAA,wCACwD;AAC1C,cAAJC,IAAI,CAACC,MAAD,EAAiB;AACvB,eAAKC,GAAL,GAAW,KAAKC,IAAL,CAAUC,YAAV;AAAA;AAAA,uEAAX;AACA,gBAAM,KAAKF,GAAL,CAASF,IAAT,EAAN;AACA,gBAAMA,IAAN,CAAWC,MAAX;AACA;AAAA;AAAA,4CAAaI,QAAb,CAAsBC,EAAtB,CAAyB;AAAA;AAAA,wCAAWC,eAApC,EAAqD,KAAKC,QAA1D,EAAoE,IAApE;AACH;;AAEDC,QAAAA,SAAS,GAAE;AACP,gBAAMA,SAAN;AACA;AAAA;AAAA,4CAAaJ,QAAb,CAAsBK,GAAtB,CAA0B;AAAA;AAAA,wCAAWH,eAArC,EAAsD,KAAKC,QAA3D;AACH;;AAEDA,QAAAA,QAAQ,GAAE;AACN,cAAG,KAAKG,KAAL,KAAe;AAAA;AAAA,sDAAkBC,KAAjC,IAA0C,CAAC;AAAA;AAAA,0CAAYP,QAAZ,CAAqBQ,MAAnE,EAA0E;AACtE;AACH;;AACD,gBAAM;AAAEC,YAAAA,CAAC,EAAEC,OAAL;AAAcC,YAAAA,CAAC,EAAEC,OAAjB;AAA0BN,YAAAA,KAAK,EAAEO;AAAjC,cAAiD;AAAA;AAAA,0CAAYb,QAAZ,CAAqBQ,MAA5E;;AACA,cAAGK,WAAW,KAAK;AAAA;AAAA,sDAAkBN,KAArC,EAA2C;AACvC;AACH;;AACD,cACK,KAAKE,CAAL,KAAWC,OAAX,IAAsBI,IAAI,CAACC,GAAL,CAAS,KAAKJ,CAAL,GAASC,OAAlB,KAA8B,CAArD,IACC,KAAKD,CAAL,KAAWC,OAAX,IAAsBE,IAAI,CAACC,GAAL,CAAS,KAAKN,CAAL,GAASC,OAAlB,KAA8B,CAFzD,EAGC;AACG,iBAAKJ,KAAL,GAAa;AAAA;AAAA,wDAAkBU,MAA/B,CADH,CAEG;;AACA;AAAA;AAAA,8CAAahB,QAAb,CAAsBiB,IAAtB,CAA2B;AAAA;AAAA,0CAAWC,aAAtC,EAAqD;AAAA;AAAA,wDAAkBX,KAAvE;AACH,WAPD,MAOM;AACF,iBAAKD,KAAL,GAAa;AAAA;AAAA,wDAAkBa,IAA/B;AACH;AACJ;;AA/BmD,O","sourcesContent":["import {_decorator} from 'cc';\nimport {DIRECTION_ENUM, ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM, EVENT_ENUM} from \"db://assets/Enums\";\nimport EventManager from \"db://assets/Runtime/EventManager\";\nimport {EntityManager} from \"db://assets/Base/EntityManager\";\nimport DataManager from \"db://assets/Runtime/DataManager\";\nimport {WoodenSkeletonStateMachine} from \"db://assets/Scripts/WoodenSkeleton/WoodenSkeletonStateMachine\";\nimport {EnemyManager} from \"db://assets/Base/EnemyManager\";\nimport {IEntity} from \"db://assets/Levels\";\n\nconst { ccclass, property } = _decorator;\n\nconst ANIMATION_SPEED = 1/8;\n\n@ccclass('WoodenSkeletonManager')\nexport class WoodenSkeletonManager extends EnemyManager {\n    async init(params: IEntity){\n        this.fsm = this.node.addComponent(WoodenSkeletonStateMachine);\n        await this.fsm.init();\n        super.init(params);\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_MOVE_END, this.onAttack, this);\n    }\n\n    onDestroy(){\n        super.onDestroy();\n        EventManager.Instance.off(EVENT_ENUM.PLAYER_MOVE_END, this.onAttack);\n    }\n\n    onAttack(){\n        if(this.state === ENTITY_STATE_ENUM.DEATH || !DataManager.Instance.player){\n            return;\n        }\n        const { x: playerX, y: playerY, state: playerState } = DataManager.Instance.player;\n        if(playerState === ENTITY_STATE_ENUM.DEATH){\n            return\n        }\n        if(\n            (this.x === playerX && Math.abs(this.y - playerY) <= 1) ||\n            (this.y === playerY && Math.abs(this.x - playerX) <= 1)\n        ){\n            this.state = ENTITY_STATE_ENUM.ATTACK;\n            //玩家切换die状态\n            EventManager.Instance.emit(EVENT_ENUM.ATTACK_PLAYER, ENTITY_STATE_ENUM.DEATH);\n        }else {\n            this.state = ENTITY_STATE_ENUM.IDLE;\n        }\n    }\n\n}\n\n"]}