{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/Burst/BurstStateMachine.ts"],"names":["_decorator","Animation","FSM_PARAMS_TYPE_ENUM","PARAMS_NAME_ENUM","getInitParamsNumber","getInitParamsTrigger","StateMachine","State","ccclass","property","BASE_URL","BurstStateMachine","restTrigger","_","item","params","type","TRIGGER","value","init","animationComponent","addComponent","initParams","initStateMachine","initAnimationEvent","Promise","all","waitingList","set","IDLE","ATTACK","DEATH","DIRECTION","stateMachines","run","currentState","get"],"mappings":"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","sourcesContent":["import {_decorator, Animation, AnimationClip, Component, SpriteFrame} from 'cc';\nimport {ENTITY_STATE_ENUM, FSM_PARAMS_TYPE_ENUM, PARAMS_NAME_ENUM} from \"db://assets/Enums\";\nimport {getInitParamsNumber, getInitParamsTrigger, StateMachine} from \"db://assets/Base/StateMachine\";\nimport IdleSubStateMachine from \"db://assets/Scripts/WoodenSkeleton/IdleSubStateMachine\";\nimport AttackSubStateMachine from \"db://assets/Scripts/WoodenSkeleton/AttackSubStateMachine\";\nimport {EntityManager} from \"db://assets/Base/EntityManager\";\nimport DeathSubStateMachine from \"db://assets/Scripts/WoodenSkeleton/DeathSubStateMachine\";\nimport State from \"db://assets/Base/State\";\n\nconst { ccclass, property } = _decorator;\n\nconst BASE_URL = 'texture/burst';\n\n@ccclass('BurstStateMachine')\nexport class BurstStateMachine extends StateMachine {\n\n    restTrigger(){\n        for(const [_, item] of this.params){\n            if(item.type === FSM_PARAMS_TYPE_ENUM.TRIGGER){\n                item.value = false;\n            }\n        }\n    }\n\n    async init(){\n        this.animationComponent = this.addComponent(Animation);\n        this.initParams();\n        this.initStateMachine();\n        this.initAnimationEvent();\n        await Promise.all(this.waitingList);\n    }\n\n    initParams(){\n        //注册参数\n        this.params.set(PARAMS_NAME_ENUM.IDLE, getInitParamsTrigger());\n        this.params.set(PARAMS_NAME_ENUM.ATTACK, getInitParamsTrigger());\n        this.params.set(PARAMS_NAME_ENUM.DEATH, getInitParamsTrigger());\n        this.params.set(PARAMS_NAME_ENUM.DIRECTION, getInitParamsNumber());\n    }\n\n    initStateMachine(){\n        //注册子状态机\n        this.stateMachines.set(PARAMS_NAME_ENUM.IDLE, new State(this, `${BASE_URL}/idle`));\n        this.stateMachines.set(PARAMS_NAME_ENUM.ATTACK, new State(this, `${BASE_URL}/attack`));\n        this.stateMachines.set(PARAMS_NAME_ENUM.DEATH, new State(this, `${BASE_URL}/death`));\n    }\n\n    initAnimationEvent(){\n        // this.animationComponent.on(Animation.EventType.FINISHED, ()=> {\n        //     const name = this.animationComponent.defaultClip.name;\n        //     const whiteList = ['attack'];\n        //     if(whiteList.some(v=> name.includes(v))){\n        //         this.node.getComponent(EntityManager).state = ENTITY_STATE_ENUM.IDLE;\n        //     }\n        // });\n    }\n\n    run(){\n        switch (this.currentState){\n            case this.stateMachines.get(PARAMS_NAME_ENUM.IDLE):\n            case this.stateMachines.get(PARAMS_NAME_ENUM.ATTACK):\n            case this.stateMachines.get(PARAMS_NAME_ENUM.DEATH):\n              if(this.params.get(PARAMS_NAME_ENUM.IDLE).value){\n                    this.currentState = this.stateMachines.get(PARAMS_NAME_ENUM.IDLE);\n                }else if(this.params.get(PARAMS_NAME_ENUM.ATTACK).value){\n                  this.currentState = this.stateMachines.get(PARAMS_NAME_ENUM.ATTACK);\n              }else if(this.params.get(PARAMS_NAME_ENUM.DEATH).value){\n                  this.currentState = this.stateMachines.get(PARAMS_NAME_ENUM.DEATH);\n              }else{\n                    this.currentState = this.currentState;\n                }\n                break;\n            default:\n                this.currentState = this.stateMachines.get(PARAMS_NAME_ENUM.IDLE);\n        }\n    }\n}\n\n"]}