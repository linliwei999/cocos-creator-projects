{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/Tile/TileMapManager.ts"],"names":["_decorator","Component","TileManager","createUINode","randomByRange","DataManager","ResourceManager","ccclass","property","TileMapManager","init","spriteFrames","Instance","loadDir","mapInfo","tileInfo","i","length","column","j","item","src","type","node","number","imgSrc","spriteFrame","find","v","name","tileManager","addComponent","setParent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;AAGbC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,Y,iBAAAA,Y;AAAcC,MAAAA,a,iBAAAA,a;;AACfC,MAAAA,W;;AACAC,MAAAA,e;;;;;;;OALD;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;gCAQjBS,c,WADZF,OAAO,CAAC,gBAAD,C,gBAAR,MACaE,cADb,SACoCR,SADpC,CAC8C;AAChC,cAAJS,IAAI,GAAI;AACV,gBAAMC,YAAY,GAAG,MAAM;AAAA;AAAA,kDAAgBC,QAAhB,CAAyBC,OAAzB,CAAiC,mBAAjC,CAA3B,CADU,CAEV;AACA;;AACA,gBAAM;AAAEC,YAAAA;AAAF,cAAc;AAAA;AAAA,0CAAYF,QAAhC;AACA;AAAA;AAAA,0CAAYA,QAAZ,CAAqBG,QAArB,GAAgC,EAAhC;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,OAAO,CAACG,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,kBAAME,MAAM,GAAGJ,OAAO,CAACE,CAAD,CAAtB;AACA;AAAA;AAAA,4CAAYJ,QAAZ,CAAqBG,QAArB,CAA8BC,CAA9B,IAAmC,EAAnC;;AACA,iBAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAAM,CAACD,MAA3B,EAAmCE,CAAC,EAApC,EAAwC;AACpC,oBAAMC,IAAI,GAAGF,MAAM,CAACC,CAAD,CAAnB;;AACA,kBAAGC,IAAI,CAACC,GAAL,KAAa,IAAb,IAAqBD,IAAI,CAACE,IAAL,KAAc,IAAtC,EAA2C;AACvC;AACH;;AACD,oBAAMC,IAAI,GAAG;AAAA;AAAA,iDAAb;AACA,kBAAIC,MAAM,GAAGJ,IAAI,CAACC,GAAlB;;AACA,kBAAG,CAACG,MAAM,KAAK,CAAX,IAAgBA,MAAM,KAAK,CAA3B,IAAgCA,MAAM,KAAK,CAA5C,KAAmDR,CAAC,GAAC,CAAF,KAAQ,CAA3D,IAAkEG,CAAC,GAAC,CAAF,KAAQ,CAA7E,EAAgF;AAC5EK,gBAAAA,MAAM,IAAI;AAAA;AAAA,oDAAc,CAAd,EAAiB,CAAjB,CAAV;AACH;;AACD,oBAAMC,MAAM,GAAI,SAAQD,MAAO,GAA/B;AACA,oBAAME,WAAW,GAAGf,YAAY,CAACgB,IAAb,CAAkBC,CAAC,IAAIA,CAAC,CAACC,IAAF,KAAWJ,MAAlC,KAA6Cd,YAAY,CAAC,CAAD,CAA7E;AACA,oBAAMmB,WAAW,GAAGP,IAAI,CAACQ,YAAL;AAAA;AAAA,6CAApB;AACA,oBAAMT,IAAI,GAAGF,IAAI,CAACE,IAAlB;AACAQ,cAAAA,WAAW,CAACpB,IAAZ,CAAiBY,IAAjB,EAAuBI,WAAvB,EAAoCV,CAApC,EAAuCG,CAAvC;AACA;AAAA;AAAA,8CAAYP,QAAZ,CAAqBG,QAArB,CAA8BC,CAA9B,EAAiCG,CAAjC,IAAsCW,WAAtC;AACAP,cAAAA,IAAI,CAACS,SAAL,CAAe,KAAKT,IAApB;AACH;AACJ;AACJ,SA7ByC,CA+B1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AA3C0C,O","sourcesContent":["import { _decorator, Component, Node, Sprite, resources, SpriteFrame, UITransform, Layers } from 'cc';\nconst { ccclass, property } = _decorator;\nimport Levels from \"db://assets/Levels\";\nimport {TileManager} from \"db://assets/Scripts/Tile/TileManager\";\nimport {createUINode, randomByRange} from \"db://assets/Utils\";\nimport DataManager from \"db://assets/Runtime/DataManager\";\nimport ResourceManager from \"db://assets/Runtime/ResourceManager\";\n\n@ccclass('TileMapManager')\nexport class TileMapManager extends Component {\n    async init () {\n        const spriteFrames = await ResourceManager.Instance.loadDir(\"texture/tile/tile\");\n        // console.log('地图信息：', level );\n        // console.log(spriteFrames);\n        const { mapInfo } = DataManager.Instance;\n        DataManager.Instance.tileInfo = [];\n        for (let i = 0; i < mapInfo.length; i++) {\n            const column = mapInfo[i];\n            DataManager.Instance.tileInfo[i] = [];\n            for (let j = 0; j < column.length; j++) {\n                const item = column[j];\n                if(item.src === null || item.type === null){\n                    continue\n                }\n                const node = createUINode();\n                let number = item.src;\n                if((number === 1 || number === 5 || number === 9) && (i%2 === 0) && (j%2 === 0)){\n                    number += randomByRange(0, 4);\n                }\n                const imgSrc = `tile (${number})`;\n                const spriteFrame = spriteFrames.find(v => v.name === imgSrc) || spriteFrames[0];\n                const tileManager = node.addComponent(TileManager);\n                const type = item.type;\n                tileManager.init(type, spriteFrame, i, j);\n                DataManager.Instance.tileInfo[i][j] = tileManager;\n                node.setParent(this.node);\n            }\n        }\n    }\n\n    // loadRes () {\n    //     return new Promise<SpriteFrame[]>((resolve, reject) => {\n    //         // 加载 test assets 目录下所有 SpriteFrame，并且获取它们的路径\n    //         resources.loadDir(\"texture/tile/tile\", SpriteFrame, function (err, assets) {\n    //             if(err){\n    //                 reject(err);\n    //                 return\n    //             }\n    //             resolve(assets);\n    //         });\n    //     });\n    //\n    // }\n}\n\n"]}