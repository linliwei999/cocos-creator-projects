{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Base/State.ts"],"names":["State","AnimationClip","Sprite","animation","ResourceManager","sortSpriteFrame","ANIMATION_SPEED","constructor","fsm","path","wrapMode","WrapMode","Normal","init","promise","Instance","loadDir","waitingList","push","spriteFrames","animationClip","track","ObjectTrack","TrackPath","toComponent","toProperty","frames","map","item","index","channel","curve","assignSorted","addTrack","name","duration","length","run","animationComponent","defaultClip","play"],"mappings":";;;kGAWqBA,K;;;;;;;;;;;;;;;;;;;;;;;AAPbC,MAAAA,a,OAAAA,a;AAAeC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,S,OAAAA,S;;AACxBC,MAAAA,e;;AAECC,MAAAA,e,iBAAAA,e;;;;;;;AAEFC,MAAAA,e,GAAkB,IAAE,C;;yBAELN,K,GAAN,MAAMA,KAAN,CAAY;AACvBO,QAAAA,WAAW,CACCC,GADD,EAECC,IAFD,EAGCC,QAAgC,GAAGT,aAAa,CAACU,QAAd,CAAuBC,MAH3D,EAIV;AAAA;;AAAA,eAHWJ,GAGX,GAHWA,GAGX;AAAA,eAFWC,IAEX,GAFWA,IAEX;AAAA,eADWC,QACX,GADWA,QACX;AACG,eAAKG,IAAL;AACH;;AAGS,cAAJA,IAAI,GAAE;AACR,gBAAMC,OAAO,GAAG;AAAA;AAAA,kDAAgBC,QAAhB,CAAyBC,OAAzB,CAAiC,KAAKP,IAAtC,CAAhB;AACA,eAAKD,GAAL,CAASS,WAAT,CAAqBC,IAArB,CAA0BJ,OAA1B;AACA,gBAAMK,YAAY,GAAG,MAAML,OAA3B;AACA,eAAKM,aAAL,GAAqB,IAAInB,aAAJ,EAArB;AAEA,gBAAMoB,KAAK,GAAG,IAAIlB,SAAS,CAACmB,WAAd,EAAd,CANQ,CAMmC;;AAC3CD,UAAAA,KAAK,CAACZ,IAAN,GAAa,IAAIN,SAAS,CAACoB,SAAd,GAA0BC,WAA1B,CAAsCtB,MAAtC,EAA8CuB,UAA9C,CAAyD,aAAzD,CAAb,CAPQ,CAO8E;;AACtF,gBAAMC,MAAmC,GAAG;AAAA;AAAA,kDAAgBP,YAAhB,EAA8BQ,GAA9B,CAAkC,CAACC,IAAD,EAAOC,KAAP,KAAgB,CAACvB,eAAe,GAAGuB,KAAnB,EAA0BD,IAA1B,CAAlD,CAA5C,CARQ,CASR;;AACAP,UAAAA,KAAK,CAACS,OAAN,CAAcC,KAAd,CAAoBC,YAApB,CAAiCN,MAAjC,EAVQ,CAWR;;AACA,eAAKN,aAAL,CAAmBa,QAAnB,CAA4BZ,KAA5B;AACA,eAAKD,aAAL,CAAmBc,IAAnB,GAA0B,KAAKzB,IAA/B;AACA,eAAKW,aAAL,CAAmBe,QAAnB,GAA8BT,MAAM,CAACU,MAAP,GAAgB9B,eAA9C,CAdQ,CAcuD;;AAC/D,eAAKc,aAAL,CAAmBV,QAAnB,GAA8B,KAAKA,QAAnC;AACH;;AAED2B,QAAAA,GAAG,GAAE;AACD,eAAK7B,GAAL,CAAS8B,kBAAT,CAA4BC,WAA5B,GAA0C,KAAKnB,aAA/C;AACA,eAAKZ,GAAL,CAAS8B,kBAAT,CAA4BE,IAA5B;AACH;;AA/BsB,O","sourcesContent":["/****\n* 1.需要知道animationClip\n* 2.需要具有播放动画能力\n* */\nimport {AnimationClip, Sprite, animation, SpriteFrame } from \"cc\";\nimport ResourceManager from \"db://assets/Runtime/ResourceManager\";\nimport {StateMachine} from \"db://assets/Base/StateMachine\";\nimport {sortSpriteFrame} from \"db://assets/Utils\";\n\nconst ANIMATION_SPEED = 1/8;\n\nexport default class State {\n    constructor(\n        private fsm: StateMachine,\n        private path: string,\n        private wrapMode: AnimationClip.WrapMode = AnimationClip.WrapMode.Normal\n    ){\n        this.init();\n    }\n    private animationClip: AnimationClip\n\n    async init(){\n        const promise = ResourceManager.Instance.loadDir(this.path);\n        this.fsm.waitingList.push(promise);\n        const spriteFrames = await promise;\n        this.animationClip = new AnimationClip();\n\n        const track = new animation.ObjectTrack(); // 创建一个对象轨道\n        track.path = new animation.TrackPath().toComponent(Sprite).toProperty('spriteFrame'); // 指定轨道路径\n        const frames:Array<[number, SpriteFrame]> = sortSpriteFrame(spriteFrames).map((item, index)=> [ANIMATION_SPEED * index, item]);\n        // 为 x 通道的曲线添加关键帧\n        track.channel.curve.assignSorted(frames);\n        // 最后将轨道添加到动画剪辑以应用\n        this.animationClip.addTrack(track);\n        this.animationClip.name = this.path;\n        this.animationClip.duration = frames.length * ANIMATION_SPEED; // 整个动画剪辑的周期\n        this.animationClip.wrapMode = this.wrapMode;\n    }\n\n    run(){\n        this.fsm.animationComponent.defaultClip = this.animationClip;\n        this.fsm.animationComponent.play();\n    }\n}"]}