{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/Player/PlayerManager.ts"],"names":["_decorator","Component","Sprite","UITransform","TILE_HEIGHT","TILE_WIDTH","CONTROLLER_ENUM","DIRECTION_ENUM","DIRECTION_ODER_ENUM","ENTITY_STATE_ENUM","EVENT_ENUM","PARAMS_NAME_ENUM","EventManager","PlayerStateMachine","ccclass","property","ANIMATION_SPEED","PlayerManager","direction","_direction","newDirection","fsm","setParams","DIRECTION","state","_state","newState","init","sprite","addComponent","sizeMode","SizeMode","CUSTOM","transform","getComponent","setContentSize","node","IDLE","Instance","on","PLAYER_CTRL","move","updateXY","targetX","x","speed","targetY","y","Math","abs","inputDirection","TOP","BOTTOM","LEFT","RIGHT","TURNLEFT","update","setPosition"],"mappings":"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","sourcesContent":["import {_decorator, Component, Sprite, UITransform} from 'cc';\nimport {TILE_HEIGHT, TILE_WIDTH} from \"db://assets/Scripts/Tile/TileManager\";\nimport {\n    CONTROLLER_ENUM,\n    DIRECTION_ENUM,\n    DIRECTION_ODER_ENUM,\n    ENTITY_STATE_ENUM,\n    EVENT_ENUM,\n    PARAMS_NAME_ENUM\n} from \"db://assets/Enums\";\nimport EventManager from \"db://assets/Runtime/EventManager\";\nimport {PlayerStateMachine} from \"db://assets/Scripts/Player/PlayerStateMachine\";\n\nconst { ccclass, property } = _decorator;\n\nconst ANIMATION_SPEED = 1/8;\n\n@ccclass('PlayerManager')\nexport class PlayerManager extends Component {\n    x:number = 0\n    y:number = 0\n    targetX:number = 0\n    targetY:number = 0\n    // private readonly speed = 1/10\n    private readonly speed = ANIMATION_SPEED\n    fsm: PlayerStateMachine\n\n    private _direction: DIRECTION_ENUM\n    private _state: ENTITY_STATE_ENUM\n\n    get direction(){\n        return this._direction;\n    }\n\n    set direction(newDirection){\n        this._direction = newDirection;\n        this.fsm.setParams(PARAMS_NAME_ENUM.DIRECTION, DIRECTION_ODER_ENUM[this._direction]);\n    }\n\n    get state(){\n        return this._state;\n    }\n\n    //数据驱动视图变化\n    set state(newState){\n        this._state = newState;\n        this.fsm.setParams(this._state, true);\n    }\n\n    async init(){\n        const sprite = this.addComponent(Sprite);\n        sprite.sizeMode = Sprite.SizeMode.CUSTOM;\n        const transform = this.getComponent(UITransform);\n        transform.setContentSize(TILE_WIDTH * 4, TILE_HEIGHT * 4);\n\n        this.fsm = this.node.addComponent(PlayerStateMachine);\n        await this.fsm.init();\n        this.state = ENTITY_STATE_ENUM.IDLE;\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_CTRL, this.move, this);\n    }\n\n    updateXY(){\n        if(this.targetX < this.x){\n            this.x -= this.speed\n        }else if(this.targetX > this.x){\n            this.x += this.speed\n        }\n\n        if(this.targetY < this.y){\n            this.y -= this.speed\n        }else if(this.targetY > this.y){\n            this.y += this.speed\n        }\n\n        if(Math.abs(this.targetX - this.x) < -0.1 && Math.abs(this.targetY - this.y) < -0.1){\n            this.x = this.targetX;\n            this.y = this.targetY;\n        }\n    }\n\n    //玩家移动\n    move(inputDirection: CONTROLLER_ENUM){\n        if (inputDirection === CONTROLLER_ENUM.TOP){\n            this.targetY -=1\n        }else if(inputDirection === CONTROLLER_ENUM.BOTTOM){\n            this.targetY +=1\n        }else if(inputDirection === CONTROLLER_ENUM.LEFT){\n            this.targetX -=1\n        }else if(inputDirection === CONTROLLER_ENUM.RIGHT){\n            this.targetX +=1\n        }else if(inputDirection === CONTROLLER_ENUM.TURNLEFT){\n            if(this.direction === DIRECTION_ENUM.TOP){\n                this.direction = DIRECTION_ENUM.LEFT;\n            }else if(this.direction === DIRECTION_ENUM.LEFT){\n                this.direction = DIRECTION_ENUM.BOTTOM;\n            }else if(this.direction === DIRECTION_ENUM.BOTTOM){\n                this.direction = DIRECTION_ENUM.RIGHT;\n            }else if(this.direction === DIRECTION_ENUM.RIGHT){\n                this.direction = DIRECTION_ENUM.TOP;\n            }\n            this.state = ENTITY_STATE_ENUM.TURNLEFT;\n        }\n    }\n\n    update(){\n        this.updateXY();\n        this.node.setPosition(this.x * TILE_WIDTH - 1.5 * TILE_WIDTH, -this.y * TILE_HEIGHT + 1.5 * TILE_HEIGHT);\n    }\n}\n\n"]}