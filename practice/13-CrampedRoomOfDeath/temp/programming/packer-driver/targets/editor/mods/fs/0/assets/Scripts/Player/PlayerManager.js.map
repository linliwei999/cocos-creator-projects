{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/Player/PlayerManager.ts"],"names":["_decorator","CONTROLLER_ENUM","DIRECTION_ENUM","ENTITY_STATE_ENUM","ENTITY_TYPE_ENUM","EVENT_ENUM","EventManager","PlayerStateMachine","EntityManager","ccclass","property","ANIMATION_SPEED","PlayerManager","init","fsm","node","addComponent","x","y","type","PLAYER","direction","TOP","state","IDLE","Instance","on","PLAYER_CTRL","move","updateXY","targetX","speed","targetY","Math","abs","inputDirection","BOTTOM","LEFT","RIGHT","TURNLEFT","update"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,MAAAA,U,OAAAA,U;;AACAC,MAAAA,e,iBAAAA,e;AAAiBC,MAAAA,c,iBAAAA,c;AAAgBC,MAAAA,iB,iBAAAA,iB;AAAmBC,MAAAA,gB,iBAAAA,gB;AAAkBC,MAAAA,U,iBAAAA,U;;AACvEC,MAAAA,Y;;AACCC,MAAAA,kB,iBAAAA,kB;;AACAC,MAAAA,a,iBAAAA,a;;;;;;;OAEF;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;AAExBW,MAAAA,e,GAAkB,IAAE,C;;+BAGbC,a,WADZH,OAAO,CAAC,eAAD,C,yBAAR,MACaG,aADb;AAAA;AAAA,0CACiD;AAAA;AAAA;;AAAA,2CAC5B,CAD4B;;AAAA,2CAE5B,CAF4B;;AAAA,yCAGpBD,eAHoB;AAAA;;AAKnC,cAAJE,IAAI,GAAE;AACR,eAAKC,GAAL,GAAW,KAAKC,IAAL,CAAUC,YAAV;AAAA;AAAA,uDAAX;AACA,gBAAM,KAAKF,GAAL,CAASD,IAAT,EAAN;AACA,gBAAMA,IAAN,CAAW;AACPI,YAAAA,CAAC,EAAE,CADI;AAEPC,YAAAA,CAAC,EAAE,CAFI;AAGPC,YAAAA,IAAI,EAAE;AAAA;AAAA,sDAAiBC,MAHhB;AAIPC,YAAAA,SAAS,EAAE;AAAA;AAAA,kDAAeC,GAJnB;AAKPC,YAAAA,KAAK,EAAE;AAAA;AAAA,wDAAkBC;AALlB,WAAX;AAOA;AAAA;AAAA,4CAAaC,QAAb,CAAsBC,EAAtB,CAAyB;AAAA;AAAA,wCAAWC,WAApC,EAAiD,KAAKC,IAAtD,EAA4D,IAA5D;AACH;;AAEDC,QAAAA,QAAQ,GAAE;AACN,cAAG,KAAKC,OAAL,GAAe,KAAKb,CAAvB,EAAyB;AACrB,iBAAKA,CAAL,IAAU,KAAKc,KAAf;AACH,WAFD,MAEM,IAAG,KAAKD,OAAL,GAAe,KAAKb,CAAvB,EAAyB;AAC3B,iBAAKA,CAAL,IAAU,KAAKc,KAAf;AACH;;AAED,cAAG,KAAKC,OAAL,GAAe,KAAKd,CAAvB,EAAyB;AACrB,iBAAKA,CAAL,IAAU,KAAKa,KAAf;AACH,WAFD,MAEM,IAAG,KAAKC,OAAL,GAAe,KAAKd,CAAvB,EAAyB;AAC3B,iBAAKA,CAAL,IAAU,KAAKa,KAAf;AACH;;AAED,cAAGE,IAAI,CAACC,GAAL,CAAS,KAAKJ,OAAL,GAAe,KAAKb,CAA7B,IAAkC,CAAC,GAAnC,IAA0CgB,IAAI,CAACC,GAAL,CAAS,KAAKF,OAAL,GAAe,KAAKd,CAA7B,IAAkC,CAAC,GAAhF,EAAoF;AAChF,iBAAKD,CAAL,GAAS,KAAKa,OAAd;AACA,iBAAKZ,CAAL,GAAS,KAAKc,OAAd;AACH;AACJ,SAnC4C,CAqC7C;;;AACAJ,QAAAA,IAAI,CAACO,cAAD,EAAiC;AACjC,cAAIA,cAAc,KAAK;AAAA;AAAA,kDAAgBb,GAAvC,EAA2C;AACvC,iBAAKU,OAAL,IAAe,CAAf;AACH,WAFD,MAEM,IAAGG,cAAc,KAAK;AAAA;AAAA,kDAAgBC,MAAtC,EAA6C;AAC/C,iBAAKJ,OAAL,IAAe,CAAf;AACH,WAFK,MAEA,IAAGG,cAAc,KAAK;AAAA;AAAA,kDAAgBE,IAAtC,EAA2C;AAC7C,iBAAKP,OAAL,IAAe,CAAf;AACH,WAFK,MAEA,IAAGK,cAAc,KAAK;AAAA;AAAA,kDAAgBG,KAAtC,EAA4C;AAC9C,iBAAKR,OAAL,IAAe,CAAf;AACH,WAFK,MAEA,IAAGK,cAAc,KAAK;AAAA;AAAA,kDAAgBI,QAAtC,EAA+C;AACjD,gBAAG,KAAKlB,SAAL,KAAmB;AAAA;AAAA,kDAAeC,GAArC,EAAyC;AACrC,mBAAKD,SAAL,GAAiB;AAAA;AAAA,oDAAegB,IAAhC;AACH,aAFD,MAEM,IAAG,KAAKhB,SAAL,KAAmB;AAAA;AAAA,kDAAegB,IAArC,EAA0C;AAC5C,mBAAKhB,SAAL,GAAiB;AAAA;AAAA,oDAAee,MAAhC;AACH,aAFK,MAEA,IAAG,KAAKf,SAAL,KAAmB;AAAA;AAAA,kDAAee,MAArC,EAA4C;AAC9C,mBAAKf,SAAL,GAAiB;AAAA;AAAA,oDAAeiB,KAAhC;AACH,aAFK,MAEA,IAAG,KAAKjB,SAAL,KAAmB;AAAA;AAAA,kDAAeiB,KAArC,EAA2C;AAC7C,mBAAKjB,SAAL,GAAiB;AAAA;AAAA,oDAAeC,GAAhC;AACH;;AACD,iBAAKC,KAAL,GAAa;AAAA;AAAA,wDAAkBgB,QAA/B;AACH;AACJ;;AAEDC,QAAAA,MAAM,GAAE;AACJ,eAAKX,QAAL;AACA,gBAAMW,MAAN;AACH;;AAhE4C,O","sourcesContent":["import {_decorator} from 'cc';\nimport {CONTROLLER_ENUM, DIRECTION_ENUM, ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM, EVENT_ENUM} from \"db://assets/Enums\";\nimport EventManager from \"db://assets/Runtime/EventManager\";\nimport {PlayerStateMachine} from \"db://assets/Scripts/Player/PlayerStateMachine\";\nimport {EntityManager} from \"db://assets/Base/EntityManager\";\n\nconst { ccclass, property } = _decorator;\n\nconst ANIMATION_SPEED = 1/8;\n\n@ccclass('PlayerManager')\nexport class PlayerManager extends EntityManager {\n    targetX:number = 0\n    targetY:number = 0\n    private readonly speed = ANIMATION_SPEED\n\n    async init(){\n        this.fsm = this.node.addComponent(PlayerStateMachine);\n        await this.fsm.init();\n        super.init({\n            x: 0,\n            y: 0,\n            type: ENTITY_TYPE_ENUM.PLAYER,\n            direction: DIRECTION_ENUM.TOP,\n            state: ENTITY_STATE_ENUM.IDLE\n        });\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_CTRL, this.move, this);\n    }\n\n    updateXY(){\n        if(this.targetX < this.x){\n            this.x -= this.speed\n        }else if(this.targetX > this.x){\n            this.x += this.speed\n        }\n\n        if(this.targetY < this.y){\n            this.y -= this.speed\n        }else if(this.targetY > this.y){\n            this.y += this.speed\n        }\n\n        if(Math.abs(this.targetX - this.x) < -0.1 && Math.abs(this.targetY - this.y) < -0.1){\n            this.x = this.targetX;\n            this.y = this.targetY;\n        }\n    }\n\n    //玩家移动\n    move(inputDirection: CONTROLLER_ENUM){\n        if (inputDirection === CONTROLLER_ENUM.TOP){\n            this.targetY -=1\n        }else if(inputDirection === CONTROLLER_ENUM.BOTTOM){\n            this.targetY +=1\n        }else if(inputDirection === CONTROLLER_ENUM.LEFT){\n            this.targetX -=1\n        }else if(inputDirection === CONTROLLER_ENUM.RIGHT){\n            this.targetX +=1\n        }else if(inputDirection === CONTROLLER_ENUM.TURNLEFT){\n            if(this.direction === DIRECTION_ENUM.TOP){\n                this.direction = DIRECTION_ENUM.LEFT;\n            }else if(this.direction === DIRECTION_ENUM.LEFT){\n                this.direction = DIRECTION_ENUM.BOTTOM;\n            }else if(this.direction === DIRECTION_ENUM.BOTTOM){\n                this.direction = DIRECTION_ENUM.RIGHT;\n            }else if(this.direction === DIRECTION_ENUM.RIGHT){\n                this.direction = DIRECTION_ENUM.TOP;\n            }\n            this.state = ENTITY_STATE_ENUM.TURNLEFT;\n        }\n    }\n\n    update(){\n        this.updateXY();\n        super.update();\n    }\n}\n\n"]}