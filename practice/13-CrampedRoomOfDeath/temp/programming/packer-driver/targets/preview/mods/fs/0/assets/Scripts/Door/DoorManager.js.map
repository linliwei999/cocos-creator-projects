{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/Door/DoorManager.ts"],"names":["_decorator","DIRECTION_ENUM","ENTITY_STATE_ENUM","ENTITY_TYPE_ENUM","EVENT_ENUM","EventManager","EntityManager","DataManager","DoorStateMachine","ccclass","property","DoorManager","init","fsm","node","addComponent","x","y","type","DOOR","direction","TOP","state","IDLE","Instance","on","DOOR_OPEN","onOpen","onDestroy","off","allEnemyDeathFlag","enemies","every","enemy","DEATH"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQA,MAAAA,U,OAAAA,U;;AACAC,MAAAA,c,iBAAAA,c;AAAgBC,MAAAA,iB,iBAAAA,iB;AAAmBC,MAAAA,gB,iBAAAA,gB;AAAkBC,MAAAA,U,iBAAAA,U;;AACtDC,MAAAA,Y;;AACCC,MAAAA,a,iBAAAA,a;;AACDC,MAAAA,W;;AACCC,MAAAA,gB,iBAAAA,gB;;;;;;;OAEF;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;6BAGjBW,W,WADZF,OAAO,CAAC,aAAD,C,gBAAR,MACaE,WADb;AAAA;AAAA,0CAC+C;AAErCC,QAAAA,IAAI,GAAE;AAAA;AAAA;;AAAA;AACR,YAAA,KAAI,CAACC,GAAL,GAAW,KAAI,CAACC,IAAL,CAAUC,YAAV;AAAA;AAAA,qDAAX;AACA,kBAAM,KAAI,CAACF,GAAL,CAASD,IAAT,EAAN;;AACA,6CAAW;AACPI,cAAAA,CAAC,EAAE,CADI;AAEPC,cAAAA,CAAC,EAAE,CAFI;AAGPC,cAAAA,IAAI,EAAE;AAAA;AAAA,wDAAiBC,IAHhB;AAIPC,cAAAA,SAAS,EAAE;AAAA;AAAA,oDAAeC,GAJnB;AAKPC,cAAAA,KAAK,EAAE;AAAA;AAAA,0DAAkBC;AALlB,aAAX;;AAOA;AAAA;AAAA,8CAAaC,QAAb,CAAsBC,EAAtB,CAAyB;AAAA;AAAA,0CAAWC,SAApC,EAA+C,KAAI,CAACC,MAApD,EAA4D,KAA5D;AAVQ;AAWX;;AAEDC,QAAAA,SAAS,GAAE;AACP,gBAAMA,SAAN;AACA;AAAA;AAAA,4CAAaJ,QAAb,CAAsBK,GAAtB,CAA0B;AAAA;AAAA,wCAAWH,SAArC,EAAgD,KAAKC,MAArD;AACH;;AAEDA,QAAAA,MAAM,GAAE;AACJ,cAAMG,iBAAiB,GAAG;AAAA;AAAA,0CAAYN,QAAZ,CAAqBO,OAArB,CAA6BC,KAA7B,CAAoCC,KAAD,IAAUA,KAAK,CAACX,KAAN,KAAgB;AAAA;AAAA,sDAAkBY,KAA/E,CAA1B;;AACA,cAAGJ,iBAAiB,IAAI,KAAKR,KAAL,KAAe;AAAA;AAAA,sDAAkBY,KAAzD,EAA+D;AAC3D,iBAAKZ,KAAL,GAAa;AAAA;AAAA,wDAAkBY,KAA/B;AACH;AACJ;;AAzB0C,O","sourcesContent":["import {_decorator} from 'cc';\nimport {DIRECTION_ENUM, ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM, EVENT_ENUM} from \"db://assets/Enums\";\nimport EventManager from \"db://assets/Runtime/EventManager\";\nimport {EntityManager} from \"db://assets/Base/EntityManager\";\nimport DataManager from \"db://assets/Runtime/DataManager\";\nimport {DoorStateMachine} from \"db://assets/Scripts/Door/DoorStateMachine\";\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('DoorManager')\nexport class DoorManager extends EntityManager {\n\n    async init(){\n        this.fsm = this.node.addComponent(DoorStateMachine);\n        await this.fsm.init();\n        super.init({\n            x: 7,\n            y: 8,\n            type: ENTITY_TYPE_ENUM.DOOR,\n            direction: DIRECTION_ENUM.TOP,\n            state: ENTITY_STATE_ENUM.IDLE\n        });\n        EventManager.Instance.on(EVENT_ENUM.DOOR_OPEN, this.onOpen, this);\n    }\n\n    onDestroy(){\n        super.onDestroy();\n        EventManager.Instance.off(EVENT_ENUM.DOOR_OPEN, this.onOpen);\n    }\n\n    onOpen(){\n        const allEnemyDeathFlag = DataManager.Instance.enemies.every((enemy)=> enemy.state === ENTITY_STATE_ENUM.DEATH);\n        if(allEnemyDeathFlag && this.state !== ENTITY_STATE_ENUM.DEATH){\n            this.state = ENTITY_STATE_ENUM.DEATH;\n        }\n    }\n}\n\n"]}