{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/Tile/TileMapManager.ts"],"names":["_decorator","Component","resources","SpriteFrame","TileManager","createUINode","DataManagerInstance","ccclass","property","TileMapManager","init","spriteFrames","loadRes","mapInfo","i","length","column","j","item","src","type","node","imgSrc","spriteFrame","find","v","name","tileManager","addComponent","setParent","Promise","resolve","reject","loadDir","err","assets"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAyBC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,W,OAAAA,W;;AAGjDC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,mB,iBAAAA,mB;;;;;;;OAJF;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;gCAOjBS,c,WADZF,OAAO,CAAC,gBAAD,C,gBAAR,MACaE,cADb,SACoCR,SADpC,CAC8C;AACpCS,QAAAA,IAAI,GAAI;AAAA;;AAAA;AACV,gBAAMC,YAAY,SAAS,KAAI,CAACC,OAAL,EAA3B,CADU,CAEV;AACA;;AACA,gBAAM;AAAEC,cAAAA;AAAF;AAAA;AAAA,0DAAN;;AACA,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,OAAO,CAACE,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,kBAAME,MAAM,GAAGH,OAAO,CAACC,CAAD,CAAtB;;AADqC,yCAE5BG,CAF4B;AAGjC,oBAAMC,IAAI,GAAGF,MAAM,CAACC,CAAD,CAAnB;;AACA,oBAAGC,IAAI,CAACC,GAAL,KAAa,IAAb,IAAqBD,IAAI,CAACE,IAAL,KAAc,IAAtC,EAA2C;AACvC;AACH;;AACD,oBAAMC,IAAI,GAAG;AAAA;AAAA,mDAAb;AACA,oBAAMC,MAAM,cAAYJ,IAAI,CAACC,GAAjB,MAAZ;AACA,oBAAMI,WAAW,GAAGZ,YAAY,CAACa,IAAb,CAAkBC,CAAC,IAAIA,CAAC,CAACC,IAAF,KAAWJ,MAAlC,KAA6CX,YAAY,CAAC,CAAD,CAA7E;AACA,oBAAMgB,WAAW,GAAGN,IAAI,CAACO,YAAL;AAAA;AAAA,+CAApB;AACAD,gBAAAA,WAAW,CAACjB,IAAZ,CAAiBa,WAAjB,EAA8BT,CAA9B,EAAiCG,CAAjC;AACAI,gBAAAA,IAAI,CAACQ,SAAL,CAAe,KAAI,CAACR,IAApB;AAZiC;;AAErC,mBAAK,IAAIJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAAM,CAACD,MAA3B,EAAmCE,CAAC,EAApC,EAAwC;AAAA,iCAA/BA,CAA+B;;AAAA,yCAGhC;AAQP;AACJ;AAnBS;AAoBb;;AAEDL,QAAAA,OAAO,GAAI;AACP,iBAAO,IAAIkB,OAAJ,CAA2B,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACnD;AACA9B,YAAAA,SAAS,CAAC+B,OAAV,CAAkB,mBAAlB,EAAuC9B,WAAvC,EAAoD,UAAU+B,GAAV,EAAeC,MAAf,EAAuB;AACvE,kBAAGD,GAAH,EAAO;AACHF,gBAAAA,MAAM,CAACE,GAAD,CAAN;AACA;AACH;;AACDH,cAAAA,OAAO,CAACI,MAAD,CAAP;AACH,aAND;AAOH,WATM,CAAP;AAWH;;AAnCyC,O","sourcesContent":["import { _decorator, Component, Node, Sprite, resources, SpriteFrame, UITransform, Layers } from 'cc';\nconst { ccclass, property } = _decorator;\nimport Levels from \"db://assets/Levels\";\nimport {TileManager} from \"db://assets/Scripts/Tile/TileManager\";\nimport {createUINode} from \"db://assets/Utils\";\nimport {DataManagerInstance} from \"db://assets/Runtime/DataManager\";\n\n@ccclass('TileMapManager')\nexport class TileMapManager extends Component {\n    async init () {\n        const spriteFrames = await this.loadRes();\n        // console.log('地图信息：', level );\n        // console.log(spriteFrames);\n        const { mapInfo } = DataManagerInstance;\n        for (let i = 0; i < mapInfo.length; i++) {\n            const column = mapInfo[i];\n            for (let j = 0; j < column.length; j++) {\n                const item = column[j];\n                if(item.src === null || item.type === null){\n                    continue\n                }\n                const node = createUINode();\n                const imgSrc = `tile (${item.src})`;\n                const spriteFrame = spriteFrames.find(v => v.name === imgSrc) || spriteFrames[0];\n                const tileManager = node.addComponent(TileManager);\n                tileManager.init(spriteFrame, i, j);\n                node.setParent(this.node);\n            }\n        }\n    }\n\n    loadRes () {\n        return new Promise<SpriteFrame[]>((resolve, reject) => {\n            // 加载 test assets 目录下所有 SpriteFrame，并且获取它们的路径\n            resources.loadDir(\"texture/tile/tile\", SpriteFrame, function (err, assets) {\n                if(err){\n                    reject(err);\n                    return\n                }\n                resolve(assets);\n            });\n        });\n\n    }\n}\n\n"]}