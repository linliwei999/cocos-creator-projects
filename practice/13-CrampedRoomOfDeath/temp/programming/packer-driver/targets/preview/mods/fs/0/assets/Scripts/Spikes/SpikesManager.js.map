{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/Spikes/SpikesManager.ts"],"names":["_decorator","Component","Sprite","UITransform","TILE_HEIGHT","TILE_WIDTH","EVENT_ENUM","PARAMS_NAME_ENUM","SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM","EventManager","randomStringByLength","SpikesStateMachine","ccclass","property","SpikesManager","count","_count","newCount","fsm","setParams","SPIKES_CURRENT_COUNT","totalCount","_totalCount","newTotalCount","SPIKES_TOTAL_COUNT","init","params","sprite","addComponent","sizeMode","SizeMode","CUSTOM","transform","getComponent","setContentSize","node","x","y","type","Instance","on","PLAYER_MOVE_END","onLoop","update","setPosition","onDestroy","off","backZero"],"mappings":"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","sourcesContent":["import {_decorator, Component, Sprite, UITransform} from 'cc';\nimport {TILE_HEIGHT, TILE_WIDTH} from \"db://assets/Scripts/Tile/TileManager\";\nimport {\n    CONTROLLER_ENUM,\n    DIRECTION_ENUM,\n    DIRECTION_ODER_ENUM,\n    ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM,\n    EVENT_ENUM,\n    PARAMS_NAME_ENUM, SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM\n} from \"db://assets/Enums\";\nimport EventManager from \"db://assets/Runtime/EventManager\";\nimport {PlayerStateMachine} from \"db://assets/Scripts/Player/PlayerStateMachine\";\nimport {IEntity, ISpikes} from \"db://assets/Levels\";\nimport {WoodenSkeletonStateMachine} from \"db://assets/Scripts/WoodenSkeleton/WoodenSkeletonStateMachine\";\nimport {StateMachine} from \"db://assets/Base/StateMachine\";\nimport {randomStringByLength} from \"db://assets/Utils\";\nimport {SpikesStateMachine} from \"db://assets/Scripts/Spikes/SpikesStateMachine\";\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('SpikesManager')\nexport class SpikesManager extends Component {\n    id: string = randomStringByLength(12)\n    x:number = 0\n    y:number = 0\n    fsm: StateMachine\n\n    private _count: number\n    private _totalCount: number\n    private type: ENTITY_TYPE_ENUM\n\n    get count(){\n        return this._count;\n    }\n\n    set count(newCount){\n        this._count = newCount;\n        this.fsm.setParams(PARAMS_NAME_ENUM.SPIKES_CURRENT_COUNT, newCount);\n    }\n\n    get totalCount(){\n        return this._totalCount;\n    }\n\n    //数据驱动视图变化\n    set totalCount(newTotalCount){\n        this._totalCount = newTotalCount;\n        this.fsm.setParams(PARAMS_NAME_ENUM.SPIKES_TOTAL_COUNT, newTotalCount);\n    }\n\n    async init(params: ISpikes){\n        const sprite = this.addComponent(Sprite);\n        sprite.sizeMode = Sprite.SizeMode.CUSTOM;\n        const transform = this.getComponent(UITransform);\n        transform.setContentSize(TILE_WIDTH * 4, TILE_HEIGHT * 4);\n\n        // 注册状态机\n        this.fsm = this.node.addComponent(SpikesStateMachine);\n        await this.fsm.init();\n\n        this.x = params.x;\n        this.y = params.y;\n        this.type = params.type;\n        this.totalCount = SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM[this.type];\n        this.count = params.count;\n\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_MOVE_END, this.onLoop, this);\n    }\n\n    update(){\n        this.node.setPosition(this.x * TILE_WIDTH - 1.5 * TILE_WIDTH, -this.y * TILE_HEIGHT + 1.5 * TILE_HEIGHT);\n    }\n\n    onDestroy(){\n        EventManager.Instance.off(EVENT_ENUM.PLAYER_MOVE_END, this.onLoop);\n    }\n\n    onLoop(){\n        if(this.count === this.totalCount){\n            this.count = 1;\n        }else {\n            this.count++;\n        }\n    }\n\n    backZero(){\n        this.count = 0;\n    }\n}\n\n"]}