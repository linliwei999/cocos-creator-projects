{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/Player/PlayerManager.ts"],"names":["_decorator","Animation","animation","AnimationClip","Component","Sprite","UITransform","TILE_HEIGHT","TILE_WIDTH","ResourceManager","CONTROLLER_ENUM","EVENT_ENUM","EventManager","ccclass","property","ANIMATION_SPEED","PlayerManager","init","render","Instance","on","PLAYER_CTRL","move","sprite","addComponent","sizeMode","SizeMode","CUSTOM","transform","getComponent","setContentSize","spriteFrames","loadDir","animationComponent","animationClip","track","ObjectTrack","path","TrackPath","toComponent","toProperty","frames","map","item","index","channel","curve","assignSorted","addTrack","duration","length","wrapMode","WrapMode","Loop","defaultClip","play","updateXY","targetX","x","speed","targetY","y","Math","abs","inputDirection","TOP","BOTTOM","LEFT","RIGHT","update","node","setPosition"],"mappings":"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","sourcesContent":["import {_decorator, Animation, animation, AnimationClip, Component, Sprite, SpriteFrame, UITransform} from 'cc';\nimport {TILE_HEIGHT, TILE_WIDTH} from \"db://assets/Scripts/Tile/TileManager\";\nimport ResourceManager from \"db://assets/Runtime/ResourceManager\";\nimport {CONTROLLER_ENUM, EVENT_ENUM} from \"db://assets/Enums\";\nimport EventManager from \"db://assets/Runtime/EventManager\";\n\nconst { ccclass, property } = _decorator;\n\nconst ANIMATION_SPEED = 1/8;\n\n@ccclass('PlayerManager')\nexport class PlayerManager extends Component {\n    x:number = 0\n    y:number = 0\n    targetX:number = 0\n    targetY:number = 0\n    private readonly speed = 1/8\n\n    async init(){\n        await this.render();\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_CTRL, this.move, this);\n    }\n\n    async render(){\n        const sprite = this.addComponent(Sprite);\n        sprite.sizeMode = Sprite.SizeMode.CUSTOM;\n\n        const transform = this.getComponent(UITransform);\n        transform.setContentSize(TILE_WIDTH * 4, TILE_HEIGHT * 4);\n\n        const spriteFrames = await ResourceManager.Instance.loadDir('texture/player/idle/top');\n        const animationComponent = this.addComponent(Animation);\n        const animationClip = new AnimationClip();\n\n        const track = new animation.ObjectTrack(); // 创建一个对象轨道\n        track.path = new animation.TrackPath().toComponent(Sprite).toProperty('spriteFrame'); // 指定轨道路径\n        const frames:Array<[number, SpriteFrame]> = spriteFrames.map((item, index)=> [ANIMATION_SPEED * index, item]);\n        // 为 x 通道的曲线添加关键帧\n        track.channel.curve.assignSorted(frames);\n        // 最后将轨道添加到动画剪辑以应用\n        animationClip.addTrack(track);\n        animationClip.duration = frames.length * ANIMATION_SPEED; // 整个动画剪辑的周期\n        animationClip.wrapMode = AnimationClip.WrapMode.Loop;\n        animationComponent.defaultClip = animationClip;\n        animationComponent.play();\n    }\n\n    updateXY(){\n        if(this.targetX < this.x){\n            this.x -= this.speed\n        }else if(this.targetX > this.x){\n            this.x += this.speed\n        }\n\n        if(this.targetY < this.y){\n            this.y -= this.speed\n        }else if(this.targetY > this.y){\n            this.y += this.speed\n        }\n\n        if(Math.abs(this.targetX - this.x) < -0.1 && Math.abs(this.targetY - this.y) < -0.1){\n            this.x = this.targetX;\n            this.y = this.targetY;\n        }\n    }\n\n    //玩家移动\n    move(inputDirection: CONTROLLER_ENUM){\n        if (inputDirection === CONTROLLER_ENUM.TOP){\n            this.targetY -=1\n        }else if(inputDirection === CONTROLLER_ENUM.BOTTOM){\n            this.targetY +=1\n        }else if(inputDirection === CONTROLLER_ENUM.LEFT){\n            this.targetX -=1\n        }else if(inputDirection === CONTROLLER_ENUM.RIGHT){\n            this.targetX +=1\n        }\n    }\n\n    update(){\n        this.updateXY();\n        this.node.setPosition(this.x * TILE_WIDTH - 1.5 * TILE_WIDTH, -this.y * TILE_HEIGHT + 1.5 * TILE_HEIGHT);\n    }\n}\n\n"]}