{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/Player/PlayerManager.ts"],"names":["_decorator","Component","Sprite","UITransform","TILE_HEIGHT","TILE_WIDTH","CONTROLLER_ENUM","EVENT_ENUM","PARAMS_NAME_ENUM","EventManager","PlayerStateMachine","ccclass","property","ANIMATION_SPEED","PlayerManager","init","sprite","addComponent","sizeMode","SizeMode","CUSTOM","transform","getComponent","setContentSize","fsm","node","setParams","IDLE","Instance","on","PLAYER_CTRL","move","updateXY","targetX","x","speed","targetY","y","Math","abs","inputDirection","TOP","BOTTOM","LEFT","RIGHT","TURNLEFT","update","setPosition"],"mappings":"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","sourcesContent":["import {_decorator, Animation, animation, AnimationClip, Component, Sprite, SpriteFrame, UITransform} from 'cc';\nimport {TILE_HEIGHT, TILE_WIDTH} from \"db://assets/Scripts/Tile/TileManager\";\nimport ResourceManager from \"db://assets/Runtime/ResourceManager\";\nimport {CONTROLLER_ENUM, EVENT_ENUM, PARAMS_NAME_ENUM} from \"db://assets/Enums\";\nimport EventManager from \"db://assets/Runtime/EventManager\";\nimport {PlayerStateMachine} from \"db://assets/Scripts/Player/PlayerStateMachine\";\n\nconst { ccclass, property } = _decorator;\n\nconst ANIMATION_SPEED = 1/8;\n\n@ccclass('PlayerManager')\nexport class PlayerManager extends Component {\n    x:number = 0\n    y:number = 0\n    targetX:number = 0\n    targetY:number = 0\n    // private readonly speed = 1/10\n    private readonly speed = ANIMATION_SPEED\n    fsm: PlayerStateMachine\n\n    async init(){\n        const sprite = this.addComponent(Sprite);\n        sprite.sizeMode = Sprite.SizeMode.CUSTOM;\n        const transform = this.getComponent(UITransform);\n        transform.setContentSize(TILE_WIDTH * 4, TILE_HEIGHT * 4);\n\n        this.fsm = this.node.addComponent(PlayerStateMachine);\n        await this.fsm.init();\n        this.fsm.setParams(PARAMS_NAME_ENUM.IDLE, true);\n        // await this.render();\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_CTRL, this.move, this);\n    }\n\n    // async render(){\n    //     const sprite = this.addComponent(Sprite);\n    //     sprite.sizeMode = Sprite.SizeMode.CUSTOM;\n    //\n    //     const transform = this.getComponent(UITransform);\n    //     transform.setContentSize(TILE_WIDTH * 4, TILE_HEIGHT * 4);\n    //\n    //     const spriteFrames = await ResourceManager.Instance.loadDir('texture/player/idle/top');\n    //     const animationComponent = this.addComponent(Animation);\n    //     const animationClip = new AnimationClip();\n    //\n    //     const track = new animation.ObjectTrack(); // 创建一个对象轨道\n    //     track.path = new animation.TrackPath().toComponent(Sprite).toProperty('spriteFrame'); // 指定轨道路径\n    //     const frames:Array<[number, SpriteFrame]> = spriteFrames.map((item, index)=> [ANIMATION_SPEED * index, item]);\n    //     // 为 x 通道的曲线添加关键帧\n    //     track.channel.curve.assignSorted(frames);\n    //     // 最后将轨道添加到动画剪辑以应用\n    //     animationClip.addTrack(track);\n    //     animationClip.duration = frames.length * ANIMATION_SPEED; // 整个动画剪辑的周期\n    //     animationClip.wrapMode = AnimationClip.WrapMode.Loop;\n    //     animationComponent.defaultClip = animationClip;\n    //     animationComponent.play();\n    // }\n\n    updateXY(){\n        if(this.targetX < this.x){\n            this.x -= this.speed\n        }else if(this.targetX > this.x){\n            this.x += this.speed\n        }\n\n        if(this.targetY < this.y){\n            this.y -= this.speed\n        }else if(this.targetY > this.y){\n            this.y += this.speed\n        }\n\n        if(Math.abs(this.targetX - this.x) < -0.1 && Math.abs(this.targetY - this.y) < -0.1){\n            this.x = this.targetX;\n            this.y = this.targetY;\n        }\n    }\n\n    //玩家移动\n    move(inputDirection: CONTROLLER_ENUM){\n        if (inputDirection === CONTROLLER_ENUM.TOP){\n            this.targetY -=1\n        }else if(inputDirection === CONTROLLER_ENUM.BOTTOM){\n            this.targetY +=1\n        }else if(inputDirection === CONTROLLER_ENUM.LEFT){\n            this.targetX -=1\n        }else if(inputDirection === CONTROLLER_ENUM.RIGHT){\n            this.targetX +=1\n        }else if(inputDirection === CONTROLLER_ENUM.TURNLEFT){\n            this.fsm.setParams(PARAMS_NAME_ENUM.TURNLEFT, true);\n        }\n    }\n\n    update(){\n        this.updateXY();\n        this.node.setPosition(this.x * TILE_WIDTH - 1.5 * TILE_WIDTH, -this.y * TILE_HEIGHT + 1.5 * TILE_HEIGHT);\n    }\n}\n\n"]}