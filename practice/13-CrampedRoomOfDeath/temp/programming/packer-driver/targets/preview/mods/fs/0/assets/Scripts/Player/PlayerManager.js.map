{"version":3,"sources":["file:///Users/lindanian/projects/git/cocos-creator-projects/practice/13-CrampedRoomOfDeath/assets/Scripts/Player/PlayerManager.ts"],"names":["_decorator","CONTROLLER_ENUM","DIRECTION_ENUM","ENTITY_STATE_ENUM","ENTITY_TYPE_ENUM","EVENT_ENUM","EventManager","PlayerStateMachine","EntityManager","DataManager","ccclass","property","ANIMATION_SPEED","PlayerManager","init","fsm","node","addComponent","x","y","type","PLAYER","direction","TOP","state","IDLE","targetX","targetY","Instance","on","PLAYER_CTRL","inputHandle","ATTACK_PLAYER","onDied","updateXY","speed","Math","abs","isMoving","emit","PLAYER_MOVE_END","inputDirection","enemyId","willAttack","DEATH","willBlock","console","log","move","onAttack","ATTACK","ATTACK_ENEMY","enemies","filter","item","i","length","enemyX","enemyY","id","enemyState","LEFT","RIGHT","BOTTOM","tileInfo","playerNextY","weaponNextY","BLOCKFRONT","playerTile","weaponTile","moveable","turnable","weaponNextX","TURNLEFT","nextX","nextY","BLOCKTURNLEFT","TURNRIGHT","update"],"mappings":"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","sourcesContent":["import {_decorator} from 'cc';\nimport {CONTROLLER_ENUM, DIRECTION_ENUM, ENTITY_STATE_ENUM, ENTITY_TYPE_ENUM, EVENT_ENUM} from \"db://assets/Enums\";\nimport EventManager from \"db://assets/Runtime/EventManager\";\nimport {PlayerStateMachine} from \"db://assets/Scripts/Player/PlayerStateMachine\";\nimport {EntityManager} from \"db://assets/Base/EntityManager\";\nimport DataManager from \"db://assets/Runtime/DataManager\";\n\nconst { ccclass, property } = _decorator;\n\nconst ANIMATION_SPEED = 1/8;\n\n@ccclass('PlayerManager')\nexport class PlayerManager extends EntityManager {\n    targetX:number = 0\n    targetY:number = 0\n    isMoving: boolean = false\n    private readonly speed = ANIMATION_SPEED\n    // private testAttackCount = 0\n\n    async init(){\n        this.fsm = this.node.addComponent(PlayerStateMachine);\n        await this.fsm.init();\n        super.init({\n            x: 2,\n            y: 8,\n            type: ENTITY_TYPE_ENUM.PLAYER,\n            direction: DIRECTION_ENUM.TOP,\n            state: ENTITY_STATE_ENUM.IDLE\n        });\n        this.targetX = this.x;\n        this.targetY = this.y;\n        EventManager.Instance.on(EVENT_ENUM.PLAYER_CTRL, this.inputHandle, this);\n        EventManager.Instance.on(EVENT_ENUM.ATTACK_PLAYER, this.onDied, this);\n    }\n\n    updateXY(){\n        if(this.targetX < this.x){\n            this.x -= this.speed\n        }else if(this.targetX > this.x){\n            this.x += this.speed\n        }\n\n        if(this.targetY < this.y){\n            this.y -= this.speed\n        }else if(this.targetY > this.y){\n            this.y += this.speed\n        }\n\n        if(Math.abs(this.targetX - this.x) < 0.1 && Math.abs(this.targetY - this.y) < 0.1 && this.isMoving){\n            this.x = this.targetX;\n            this.y = this.targetY;\n            this.isMoving = false;\n            EventManager.Instance.emit(EVENT_ENUM.PLAYER_MOVE_END);\n        }\n    }\n\n    inputHandle(inputDirection: CONTROLLER_ENUM){\n        //攻击\n        const enemyId = this.willAttack(inputDirection);\n        if(enemyId){\n            return;\n        }\n\n        if(this.state === ENTITY_STATE_ENUM.DEATH){\n            return;\n        }\n\n        if(this.willBlock(inputDirection)){\n            console.log('撞墙');\n            return\n        }\n        this.move(inputDirection);\n    }\n\n    onAttack(enemyId: string){\n        this.state = ENTITY_STATE_ENUM.ATTACK;\n        EventManager.Instance.emit(EVENT_ENUM.ATTACK_ENEMY, enemyId);\n        return enemyId;\n    }\n\n    willAttack(inputDirection: CONTROLLER_ENUM){\n        const enemies = DataManager.Instance.enemies.filter((item)=> item.state !== ENTITY_STATE_ENUM.DEATH);\n        for (let i = 0; i < enemies.length; i++) {\n            const { x: enemyX, y: enemyY, id: enemyId, state: enemyState } = enemies[i];\n            // if(enemyState === ENTITY_STATE_ENUM.DEATH){\n            //     return '';\n            // }\n            if(inputDirection === CONTROLLER_ENUM.TOP && this.direction === DIRECTION_ENUM.TOP && enemyX === this.x && enemyY === this.targetY - 2){\n                console.log('玩家攻击');\n                return this.onAttack(enemyId);\n            }else if(inputDirection === CONTROLLER_ENUM.LEFT && this.direction === DIRECTION_ENUM.LEFT && enemyX === this.targetX - 2 && enemyY === this.y){\n                return this.onAttack(enemyId);\n            }else if(inputDirection === CONTROLLER_ENUM.RIGHT && this.direction === DIRECTION_ENUM.RIGHT && enemyX === this.targetX + 2 && enemyY === this.y){\n                // this.testAttackCount++\n                // if(this.testAttackCount === 3){\n                //     return false;\n                // }\n                return this.onAttack(enemyId);\n            }else if(inputDirection === CONTROLLER_ENUM.BOTTOM && this.direction === DIRECTION_ENUM.BOTTOM && enemyX === this.x && enemyY === this.targetY + 2){\n                return this.onAttack(enemyId);\n            }else {\n                return '';\n            }\n        }\n    }\n\n    willBlock(inputDirection: CONTROLLER_ENUM){\n        const { targetX: x, targetY: y, direction } = this;\n        const { tileInfo } = DataManager.Instance;\n        if(inputDirection === CONTROLLER_ENUM.TOP){\n            if(direction === DIRECTION_ENUM.TOP){\n                //疑问\n                const playerNextY = y - 1;\n                const weaponNextY = y - 2;\n                //玩家走出地图\n                if(playerNextY <= 1){\n                    this.state = ENTITY_STATE_ENUM.BLOCKFRONT;\n                    return true;\n                }\n                //下一个瓦片\n                const playerTile = tileInfo[x][playerNextY];\n                const weaponTile = tileInfo[x][weaponNextY];\n                if(playerTile && playerTile.moveable && (!weaponTile || weaponTile.turnable)){\n                    //empty\n                }else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKFRONT;\n                    return true;\n                }\n            }else if(direction === DIRECTION_ENUM.LEFT){\n                //左方向移动\n                const playerNextY = y - 1;\n                const weaponNextX = x - 1;\n                const weaponNextY = playerNextY;\n                //下一个瓦片\n                const playerTile = tileInfo[x][playerNextY];\n                const weaponTile = tileInfo[weaponNextX][weaponNextY];\n                if(playerTile?.moveable && weaponTile.moveable){\n                    //empty\n                }else {\n                    return true;\n                }\n            }else if(direction === DIRECTION_ENUM.RIGHT){\n                //右方向移动\n                const playerNextY = y - 1;\n                const weaponNextX = x + 1;\n                const weaponNextY = playerNextY;\n                //下一个瓦片\n                const playerTile = tileInfo[x][playerNextY];\n                const weaponTile = tileInfo[weaponNextX][weaponNextY];\n                if(playerTile?.moveable && weaponTile.moveable){\n                    //empty\n                }else {\n                    return true;\n                }\n            }\n        }else if(inputDirection === CONTROLLER_ENUM.TURNLEFT){\n            let nextX\n            let nextY\n            if(direction === DIRECTION_ENUM.TOP){\n                nextX = x - 1;\n                nextY = y - 1;\n            }else if(direction === DIRECTION_ENUM.BOTTOM){\n                nextX = x + 1;\n                nextY = y + 1;\n            }else if(direction === DIRECTION_ENUM.LEFT){\n                nextX = x - 1;\n                nextY = y + 1;\n            }else if(direction === DIRECTION_ENUM.RIGHT){\n                nextX = x + 1;\n                nextY = y - 1;\n            }\n            if(\n                (!tileInfo[x][nextY] || tileInfo[x][nextY].turnable) &&\n                (!tileInfo[nextX][y] || tileInfo[nextX][y].turnable) &&\n                (!tileInfo[nextX][nextY] || tileInfo[nextX][nextY].turnable)\n            ){\n                //empty\n            }else {\n                this.state = ENTITY_STATE_ENUM.BLOCKTURNLEFT;\n                return true;\n            }\n        }\n        return false;\n    }\n\n    //玩家移动\n    move(inputDirection: CONTROLLER_ENUM){\n        if (inputDirection === CONTROLLER_ENUM.TOP){\n            this.targetY -=1\n        }else if(inputDirection === CONTROLLER_ENUM.BOTTOM){\n            this.targetY +=1\n        }else if(inputDirection === CONTROLLER_ENUM.LEFT){\n            this.targetX -=1\n        }else if(inputDirection === CONTROLLER_ENUM.RIGHT){\n            this.targetX +=1\n        }else if(inputDirection === CONTROLLER_ENUM.TURNLEFT){\n            if(this.direction === DIRECTION_ENUM.TOP){\n                this.direction = DIRECTION_ENUM.LEFT;\n            }else if(this.direction === DIRECTION_ENUM.LEFT){\n                this.direction = DIRECTION_ENUM.BOTTOM;\n            }else if(this.direction === DIRECTION_ENUM.BOTTOM){\n                this.direction = DIRECTION_ENUM.RIGHT;\n            }else if(this.direction === DIRECTION_ENUM.RIGHT){\n                this.direction = DIRECTION_ENUM.TOP;\n            }\n            this.state = ENTITY_STATE_ENUM.TURNLEFT;\n        }\n        if(!(inputDirection === CONTROLLER_ENUM.TURNLEFT || inputDirection === CONTROLLER_ENUM.TURNRIGHT)){\n            this.isMoving = true;\n            // EventManager.Instance.emit(EVENT_ENUM.PLAYER_MOVE_END);\n        }\n    }\n\n    onDied(type: ENTITY_STATE_ENUM){\n        this.state = type;\n    }\n\n    update(){\n        this.updateXY();\n        super.update();\n    }\n}\n\n"]}